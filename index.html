<html><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BP2 W/E/L Calculator</title>
<link rel="icon" type="image/x-icon" href="checkmark.png">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --bg-color: #f0f0f0;
    --container-bg: #fff;
    --text-color: #333;
    --border-color: #ddd;
    --hover-bg: #e8f5e9;
    --selected-border: #4CAF50;
    --button-bg: #f0f0f0;
    --button-border: #ccc;
    --scrollbar-bg: #f1f1f1;
    --scrollbar-thumb: #888;
    --scrollbar-thumb-hover: #555;
    --result-overpay-bg: #FFCCCB;
    --result-underpay-bg: #90EE90;
    --result-balanced-bg: #E6E6FA;
    --result-text-color: #333;
  }

  /* Red theme */
  .red-theme {
    --bg-color: #ffebee;
    --container-bg: #fff5f5;
    --text-color: #b71c1c;
    --border-color: #ef9a9a;
    --hover-bg: #ffcdd2;
    --selected-border: #d32f2f;
    --button-bg: #ffcdd2;
    --button-border: #ef9a9a;
    --scrollbar-bg: #ffebee;
    --scrollbar-thumb: #ef9a9a;
    --scrollbar-thumb-hover: #e57373;
    --result-overpay-bg: #d32f2f;
    --result-underpay-bg: #c62828;
    --result-balanced-bg: #b71c1c;
    --result-text-color: #fff;
  }

  /* Green theme */
  .green-theme {
    --bg-color: #e8f5e9;
    --container-bg: #f1f8e9;
    --text-color: #1b5e20;
    --border-color: #a5d6a7;
    --hover-bg: #c8e6c9;
    --selected-border: #43a047;
    --button-bg: #c8e6c9;
    --button-border: #a5d6a7;
    --scrollbar-bg: #e8f5e9;
    --scrollbar-thumb: #a5d6a7;
    --scrollbar-thumb-hover: #81c784;
    --result-overpay-bg: #43a047;
    --result-underpay-bg: #388e3c;
    --result-balanced-bg: #2e7d32;
    --result-text-color: #fff;
  }

  /* Blue theme */
  .blue-theme {
    --bg-color: #e3f2fd;
    --container-bg: #e8f0fe;
    --text-color: #0d47a1;
    --border-color: #90caf9;
    --hover-bg: #bbdefb;
    --selected-border: #1976d2;
    --button-bg: #bbdefb;
    --button-border: #90caf9;
    --scrollbar-bg: #e3f2fd;
    --scrollbar-thumb: #90caf9;
    --scrollbar-thumb-hover: #64b5f6;
    --result-overpay-bg: #1976d2;
    --result-underpay-bg: #1565c0;
    --result-balanced-bg: #0d47a1;
    --result-text-color: #fff;
  }

  .dark-mode {
    --bg-color: #1a1a1a;
    --container-bg: #2c2c2c;
    --text-color: #e0e0e0;
    --border-color: #444;
    --hover-bg: #3a3a3a;
    --selected-border: #6aba6f;
    --button-bg: #3a3a3a;
    --button-border: #555;
    --scrollbar-bg: #2c2c2c;
    --scrollbar-thumb: #555;
    --scrollbar-thumb-hover: #777;
    --result-overpay-bg: #8B0000;
    --result-underpay-bg: #006400;
    --result-balanced-bg: #483D8B;
    --result-text-color: #e0e0e0;
  }

  .custom-theme {
  }

  .color-pickers {
    margin: 15px 0;
    padding: 15px 0;
    border-top: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
  }

  .color-picker {
    display: flex;
    align-items: center;
    margin: 8px 0;
    justify-content: space-between;
  }

  .color-picker label {
    flex: 1;
    margin-right: 10px;
  }

  .color-picker input[type="color"] {
    padding: 0;
    width: 50px;
    height: 25px;
    border: 1px solid var(--border-color);
    border-radius: 3px;
    background: none;
  }

  body {
    font-family: Arial, sans-serif;
    background-color: var(--bg-color);
    margin: 0;
    padding: 20px;
    color: var(--text-color);
    transition: background-color 0.3s, color 0.3s;
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
    background-color: var(--container-bg);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }
  h1, h2, h3 {
    color: var(--text-color);
    text-align: center;
  }
  .trade-area {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
  }
  .trade-column {
    width: 48%;
    display: flex;
    flex-direction: column;
  }
  .credits-input {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
  }
  .credits-input label {
    margin-right: 5px;
  }
  .credits-input input {
    width: 100px;
  }
  .search-bar {
    margin-bottom: 10px;
    width: 100%;
  }

  .search-bar input {
    width: 100%;
    padding: 8px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background-color: var(--container-bg);
    color: var(--text-color);
  }

  .search-bar input:focus {
    outline: none;
    border-color: var(--selected-border);
  }
  
  .item-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 10px;
    margin-bottom: 20px;
    max-height: 400px;
    overflow-y: auto;
    padding-right: 10px;
  }
  .item-grid::-webkit-scrollbar {
    width: 8px;
  }
  .item-grid::-webkit-scrollbar-track {
    background: var(--scrollbar-bg);
    border-radius: 4px;
  }
  .item-grid::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 4px;
  }
  .item-grid::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
  }
  .item {
    border: 2px solid var(--border-color);
    border-radius: 5px;
    padding: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .item:hover {
    transform: scale(1.05);
    box-shadow: 0 0 5px rgba(0,0,0,0.2);
  }
  .item.selected {
    border-color: var(--selected-border);
    background-color: var(--hover-bg);
  }
  .item img {
    width: 60px;
    height: 60px;
    object-fit: contain;
  }
  .item-name {
    font-size: 12px;
    margin-top: 5px;
  }
  .item-quantity, .item-value, .item-serial {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 5px;
  }
  .item-stats {
    margin-top: 10px;
  }
  .stat-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 5px;
  }
  .stat-multiplier {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  .stat-multiplier label {
    font-size: 10px;
    margin-bottom: 2px;
  }
  .stat-multiplier input[type="number"] {
    width: 100%;
    font-size: 10px;
    padding: 2px;
  }
  .stat-multiplier input[type="checkbox"] {
    margin-right: 3px;
  }
  .item-quantity button, .item-value button {
    width: 20px;
    height: 20px;
    font-size: 14px;
    line-height: 1;
    background-color: var(--button-bg);
    border: 1px solid var(--button-border);
    cursor: pointer;
    color: var(--text-color);
  }
  .item-quantity input, .item-value input, .item-serial input {
    width: 50px;
    text-align: center;
    margin: 0 5px;
    border: 1px solid var(--button-border);
    background-color: var(--container-bg);
    color: var(--text-color);
  }
  .item-level {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 5px;
  }
  .item-level input {
    width: 50px;
    text-align: center;
    margin: 0 5px;
    border: 1px solid var(--button-border);
    background-color: var(--container-bg);
    color: var(--text-color);
  }
  .trade-summary {
    border: 1px solid var(--border-color);
    border-radius: 5px;
    padding: 10px;
    margin-top: 10px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  .trade-items {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 10px;
    padding-right: 10px;
  }
  .trade-items::-webkit-scrollbar {
    width: 8px;
  }
  .trade-items::-webkit-scrollbar-track {
    background: var(--scrollbar-bg);
    border-radius: 4px;
  }
  .trade-items::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 4px;
  }
  .trade-items::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
  }
  #result {
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    margin-top: 20px;
    padding: 15px;
    border-radius: 5px;
    line-height: 1.4;
  }
  #settingsToggle {
    position: fixed;
    top: 20px;
    left: 20px;
    padding: 10px;
    font-size: 16px;
    cursor: pointer;
    background-color: var(--button-bg);
    color: var(--text-color);
    border: 1px solid var(--button-border);
    border-radius: 5px;
    transition: all 0.3s ease;
  }

  .disclaimer-banner {
    background-color: #ffebee;
    border: 1px solid #ffcdd2;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 20px;
    text-align: center;
    color: #c62828;
  }

  .dark-mode .disclaimer-banner {
    background-color: #b71c1c;
    border-color: #c62828;
    color: #ffebee;
  }

  .updates-banner {
    background-color: #f5f5f5;
    border: 1px solid #e0e0e0;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 20px;
    text-align: left;
    color: #424242;
  }

  .dark-mode .updates-banner {
    background-color: #424242;
    border-color: #616161;
    color: #e0e0e0;
  }

  .social-banner {
    background-color: #e8f5e9;
    border: 1px solid #c8e6c9;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 20px;
    text-align: center;
    color: #2e7d32;
  }

  .dark-mode .social-banner {
    background-color: #1b5e20;
    border-color: #2e7d32;
    color: #c8e6c9;
  }

  .social-banner a {
    color: inherit;
    text-decoration: none;
    margin: 0 10px;
    font-weight: bold;
  }

  .social-banner a:hover {
    text-decoration: underline;
  }

  .item-inflation {
    margin-top: 10px;
    font-size: 12px;
  }

  .show-inflation {
    width: 100%;
    padding: 5px;
    background-color: var(--button-bg);
    border: 1px solid var(--button-border);
    color: var(--text-color);
    cursor: pointer;
    border-radius: 3px;
  }

  .inflation-details {
    margin-top: 5px;
    padding: 10px !important;
    border: 1px solid var(--border-color);
    border-radius: 3px;
  }

  .historical-values, .projected-values {
    margin: 5px 0;
    max-height: 100px;
    overflow-y: auto;
  }

  .inflation-chart-container {
    width: 100%;
    height: 200px;
    margin-top: 10px;
  }

  .inflation-rate {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .inflation-rate-input {
    width: 60px;
    text-align: center;
    background-color: var(--container-bg);
    color: var(--text-color);
    border: 1px solid var(--button-border);
    border-radius: 3px;
  }

  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }

  .modal {
    background-color: var(--container-bg);
    padding: 20px;
    border-radius: 10px;
    max-width: 800px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    color: var(--text-color);
    border: 1px solid var(--border-color);
  }

  .modal-close {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-color);
  }

  .modal-title {
    margin-top: 0;
    margin-bottom: 20px;
    padding-right: 30px;
  }

  .modal .inflation-details {
    display: block !important;
    border: none !important;
    padding: 0 !important;
  }

  .modal .inflation-chart-container {
    height: 300px;
    margin: 20px 0;
  }

  .settings-panel {
    position: fixed;
    top: 20px;
    left: 20px;
    padding: 15px;
    background-color: var(--container-bg);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    z-index: 100;
    color: var(--text-color);
    max-height: calc(100vh - 40px);
    overflow-y: auto;
    scrollbar-width: thin;
  }

  .settings-panel::-webkit-scrollbar {
    width: 8px;
  }

  .settings-panel::-webkit-scrollbar-track {
    background: var(--scrollbar-bg);
    border-radius: 4px;
  }

  .settings-panel::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 4px;
  }

  .settings-panel::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
  }

  .settings-toggle {
    position: fixed;
    top: 20px;
    left: 20px;
    padding: 10px;
    font-size: 16px;
    cursor: pointer;
    background-color: var(--button-bg);
    color: var(--text-color);
    border: 1px solid var(--button-border);
    border-radius: 5px;
    transition: all 0.3s ease;
  }

  .settings-toggle:hover {
    background-color: var(--hover-bg);
  }

  .stat-setting {
    margin: 10px 0;
    display: flex;
    align-items: center;
  }

  .stat-setting label {
    margin-left: 8px;
  }

  .serial-setting {
    margin: 15px 0;
    padding: 5px;
    border-top: 1px solid var(--border-color);
  }

  .serial-setting label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }

  .formula-inputs {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .formula-inputs input {
    width: 60px;
    padding: 3px;
    text-align: center;
    background-color: var(--container-bg);
    color: var(--text-color);
    border: 1px solid var(--button-border);
    border-radius: 3px;
  }

  .theme-setting {
    margin: 10px 0 20px 0;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
  }

  .theme-setting label {
    margin-left: 8px;
  }

  .base-value {
    margin: 5px 0;
    font-size: 12px;
    text-align: center;
  }

  .base-value input {
    width: 80px;
    text-align: center;
    margin: 0 5px;
    padding: 2px;
    border: 1px solid var(--button-border);
    background-color: var(--container-bg);
    color: var(--text-color);
    border-radius: 3px;
  }

  .base-value label {
    font-size: 11px;
  }

  .dark-mode {
    --bg-color: #1a1a1a;
    --container-bg: #2c2c2c;
    --text-color: #e0e0e0;
    --border-color: #444;
    --hover-bg: #3a3a3a;
    --selected-border: #6aba6f;
    --button-bg: #3a3a3a;
    --button-border: #555;
    --scrollbar-bg: #2c2c2c;
    --scrollbar-thumb: #555;
    --scrollbar-thumb-hover: #777;
    --result-overpay-bg: #8B0000;
    --result-underpay-bg: #006400;
    --result-balanced-bg: #483D8B;
    --result-text-color: #e0e0e0;
  }

  .dark-mode input {
    background-color: #2c2c2c;
    color: #e0e0e0;
    border-color: #444;
  }

  .dark-mode select {
    background-color: #2c2c2c;
    color: #e0e0e0;
    border-color: #444;
  }

  .dark-mode .item {
    background-color: #2c2c2c;
  }

  .dark-mode .settings-panel {
    background-color: #2c2c2c;
  }

  .dark-mode .modal {
    background-color: #2c2c2c;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>BP2 W/E/L Calculator</h1>
    <div class="disclaimer-banner">
      &#x26a0;&#xfe0f; Disclaimer: Items with special serial numbers may sell for significantly more than calculated values. This calculator provides base estimates only.
    </div>
    <div class="updates-banner">
      <strong>Recent Updates:</strong>
      <ul>
        <li>Added level multipliers for items (up to level 35/50)</li>
        <li>Added special stat multipliers (1.05x for 1 stat, 1.1x for 2 stats, 1.5x for 3 stats, 2x for 4 stats)</li>
        <li>Added serial number tracking</li>
        <li>Fixed calculation issues with high-value items</li>
		<li>Added user settings!</li>
		<li>Fixed the search bar</li>
		<li>Added custom base value</li>
		<li>Added demand for items @weetch</li>
		<li>Compare demand on both sides of trade @weetch</li>
      </ul>
    </div>
    <div class="social-banner">
      &#x1f4f1; Connect with us: 
      <a href="https://sites.google.com/view/bp2valuelist/home">Website</a> | 
      <a href="https://discord.gg/BP2">Discord Server</a>
    </div>
    <div class="trade-area">
      <div class="trade-column">
        <h2>Your Offer</h2>
        <div class="credits-input">
          <label for="yourMoney">Add Credits: </label>
          <input type="number" id="yourMoney" value="0" min="0" step="1">
        </div>
        <div class="search-bar">
          <input type="text" placeholder="Search items..." class="item-search">
        </div>
        <div id="yourItems" class="item-grid"></div>
        <div class="trade-summary">
          <h3>Your Trade Summary</h3>
          <div id="yourTradeItems" class="trade-items"></div>
          <div id="yourTotal">Total: &#x24;0 credits</div>
        </div>
      </div>
      <div class="trade-column">
        <h2>Their Offer</h2>
        <div class="credits-input">
          <label for="theirMoney">Add Credits: </label>
          <input type="number" id="theirMoney" value="0" min="0" step="1">
        </div>
        <div class="search-bar">
          <input type="text" placeholder="Search items..." class="item-search">
        </div>
        <div id="theirItems" class="item-grid"></div>
        <div class="trade-summary">
          <h3>Their Trade Summary</h3>
          <div id="theirTradeItems" class="trade-items"></div>
          <div id="theirTotal">Total: &#x24;0 credits</div>
        </div>
      </div>
    </div>
    <div id="result"></div>
  </div>
  <button id="settingsToggle" class="settings-toggle">&#x2699;&#xfe0f; Settings</button>
  <div id="settingsPanel" class="settings-panel" style="display: none;">
    <button class="close-button">&#xd7;</button>
    <div class="theme-setting">
      <label>Theme:</label>
      <select id="themeSelect">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
        <option value="red">Red</option>
        <option value="green">Green</option>
        <option value="blue">Blue</option>
        <option value="custom">Custom</option>
      </select>
    </div>
    <div class="color-pickers">
      <h3>Custom Theme Colors</h3>
      <div class="color-picker">
        <label>Background Color:</label>
        <input type="color" id="bgColor" value="#f0f0f0">
      </div>
      <div class="color-picker">
        <label>Container Background:</label>
        <input type="color" id="containerBg" value="#ffffff">
      </div>
      <div class="color-picker">
        <label>Text Color:</label>
        <input type="color" id="textColor" value="#333333">
      </div>
      <div class="color-picker">
        <label>Border Color:</label>
        <input type="color" id="borderColor" value="#dddddd">
      </div>
      <div class="color-picker">
        <label>Hover Background:</label>
        <input type="color" id="hoverBg" value="#e8f5e9">
      </div>
      <div class="color-picker">
        <label>Selected Border:</label>
        <input type="color" id="selectedBorder" value="#4CAF50">
      </div>
      <div class="color-picker">
        <label>Button Background:</label>
        <input type="color" id="buttonBg" value="#f0f0f0">
      </div>
    </div>
    <h3>Stat Settings</h3>
    <div class="stat-setting">
      <input type="checkbox" id="enableStuds" checked>
      <label for="enableStuds">Enable Studs Stat</label>
    </div>
    <div class="stat-setting">
      <input type="checkbox" id="enableTags" checked>
      <label for="enableTags">Enable Tags Stat</label>
    </div>
    <div class="stat-setting">
      <input type="checkbox" id="enableMinutes" checked>
      <label for="enableMinutes">Enable Minutes Stat</label>
    </div>
    <div class="stat-setting">
      <input type="checkbox" id="enableBullets" checked>
      <label for="enableBullets">Enable Bullets Stat</label>
    </div>
    <h3>Serial Multiplier Settings</h3>
    <div class="serial-setting">
      <label>Level 50 Formula: -A * ln(x) + B</label>
      <div class="formula-inputs">
        <input type="number" id="level50A" value="2" step="0.1"> x ln(serial) + 
        <input type="number" id="level50B" value="17" step="0.1">
      </div>
    </div>
    <div class="serial-setting">
      <label>Level 35 Formula: -A * ln(x) + B</label>
      <div class="formula-inputs">
        <input type="number" id="level35A" value="0.4" step="0.1"> x ln(serial) + 
        <input type="number" id="level35B" value="3.6" step="0.1">
      </div>
    </div>
    <div style="margin-top: 20px; border-top: 1px solid var(--border-color); padding-top: 10px;">
      <h3>Settings Import/Export</h3>
      <button onclick="exportSettings()" style="margin-right: 10px; padding: 5px 10px; background: var(--button-bg); color: var(--text-color); border: 1px solid var(--button-border); border-radius: 3px; cursor: pointer;">
        Export Settings
      </button>
      <input type="file" id="importSettings" accept=".json" style="display: none;">
      <button onclick="document.getElementById(&apos;importSettings&apos;).click()" style="padding: 5px 10px; background: var(--button-bg); color: var(--text-color); border: 1px solid var(--button-border); border-radius: 3px; cursor: pointer;">
        Import Settings
      </button>
    </div>
  </div>

  <div class="modal-overlay">
    <div class="modal">
      <button class="modal-close">&#xd7;</button>
      <h2 class="modal-title">Item Inflation Data</h2>
      <div class="modal-content"></div>
    </div>
  </div>

  <script>const items = [
      { id: 1, name: "Dark Matter Rifle", baseValue: 125000000, baseCustomValue: null, demand: "4" , image: "DarkMatterRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 50 },
      { id: 2, name: "Silenced Pistol", baseValue: 85000000, baseCustomValue: null, demand: "4" , image: "SilencedPistol.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 50 },
      { id: 3, name: "The Cobra", baseValue: 100000000, baseCustomValue: null, demand: "4" , image: "TheCobra.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 50 },
      { id: 4, name: "Thermal Sniper", baseValue: 45000000, baseCustomValue: null, demand: "3" , image: "ThermalSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 50 },
      { id: 5, name: "Spring-loaded Minigun", baseValue: 30000000, baseCustomValue: null, demand: "2" , image: "SpringLoadedMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 50 },
      { id: 6, name: "Lightweight Minigun", baseValue: 105000000, baseCustomValue: null, demand: "4" , image: "LeightweightMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 50 },
      { id: 7, name: "24k Rifle", baseValue: 35000000, baseCustomValue: null, demand: "5" , image: "24kRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 8, name: "24k Sniper", baseValue: 35000000, baseCustomValue: null, demand: "5" , image: "24kSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 9, name: "24k Minigun", baseValue: 35000000, baseCustomValue: null, demand: "5" , image: "24kMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 10, name: "Merry Rifle", baseValue: 15000000, baseCustomValue: null, demand: "4" , image: "MerryRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 11, name: "Merry Sniper", baseValue: 15000000, baseCustomValue: null, demand: "4" , image: "MerrySniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 12, name: "Merry Minigun", baseValue: 15000000, baseCustomValue: null, demand: "4" , image: "MerryMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 13, name: "Ghostfire Rifle", baseValue: 50000000, baseCustomValue: null, demand: "5" , image: "GhostfireRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 14, name: "Ghostfire Sniper", baseValue: 50000000, baseCustomValue: null, demand: "5" , image: "GhostfireSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 15, name: "Ghostfire Minigun", baseValue: 50000000, baseCustomValue: null, demand: "5" , image: "GhostfireMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 16, name: "Voodoo Rifle", baseValue: 3000000, baseCustomValue: null, demand: "3" , image: "VoodooRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 17, name: "Vampire Slayer Sniper", baseValue: 4000000, baseCustomValue: null, demand: "4" , image: "VampireSlayerSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 18, name: "Carnage Minigun", baseValue: 3000000, baseCustomValue: null, demand: "3" , image: "CarnageMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 19, name: "Zombie Rifle", baseValue: 62000, baseCustomValue: null, demand: "2" , image: "ZombieRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 20, name: "Carnage Sniper", baseValue: 62500, baseCustomValue: null, demand: "2" , image: "CarnageSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 21, name: "Evil Circus Sniper", baseValue: 62500, baseCustomValue: null, demand: "2" , image: "EvilCircusSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 22, name: "Petrified Rifle", baseValue: 6200, baseCustomValue: null, demand: "2" , image: "PetrifiedRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 23, name: "Mummywrap Sniper", baseValue: 7000, baseCustomValue: null, demand: "2" , image: "MummywrapSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 24, name: "Stitched Minigun", baseValue: 6500, baseCustomValue: null, demand: "2" , image: "StitchedMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 25, name: "Starfall Rifle", baseValue: 175000, baseCustomValue: null, demand: "1" , image: "StarfallRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 26, name: "Starfall Sniper", baseValue: 175000, baseCustomValue: null, demand: "1" , image: "StarfallSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 27, name: "Starfall Minigun", baseValue: 175000, baseCustomValue: null, demand: "1" , image: "StarfallMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 28, name: "Spitfire Rifle", baseValue: 75000, baseCustomValue: null, demand: "1" , image: "SpitfireRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 29, name: "Spitfire Sniper", baseValue: 75000, baseCustomValue: null, demand: "1" , image: "SpitfireSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 30, name: "Spitfire Minigun", baseValue: 75000, baseCustomValue: null, demand: "1" , image: "SpitfireMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 31, name: "Futura Rifle", baseValue: 450000, baseCustomValue: null, demand: "2" , image: "FuturaRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 32, name: "Futura Sniper", baseValue: 450000, baseCustomValue: null, demand: "2" , image: "FuturaSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 33, name: "Futura Minigun", baseValue: 450000, baseCustomValue: null, demand: "2" , image: "FuturaMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 34, name: "Elite Rifle", baseValue: 400000, baseCustomValue: null, demand: "2" , image: "EliteRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 35, name: "Elite Sniper", baseValue: 400000, baseCustomValue: null, demand: "2" , image: "EliteSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 36, name: "Elite Minigun", baseValue: 400000, baseCustomValue: null, demand: "2" , image: "EliteMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 37, name: "Ryu Rifle", baseValue: 3000000, baseCustomValue: null, demand: "3" , image: "RyuRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 38, name: "Ryu Sniper", baseValue: 3000000, baseCustomValue: null, demand: "3" , image: "RyuSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 39, name: "Ryu Minigun", baseValue: 3000000, baseCustomValue: null, demand: "3" , image: "RyuMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 40, name: "Lovebomb Rifle", baseValue: 3250000, baseCustomValue: null, demand: "3" , image: "LovebombRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 41, name: "Lovebomb Sniper", baseValue: 3250000, baseCustomValue: null, demand: "3" , image: "LovebombSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 42, name: "Lovebomb Minigun", baseValue: 3250000, baseCustomValue: null, demand: "3" , image: "LovebombMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 43, name: "Money Rifle", baseValue: 3250000, baseCustomValue: null, demand: "3" , image: "MoneyRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 44, name: "Money Sniper", baseValue: 3250000, baseCustomValue: null, demand: "3" , image: "MoneySniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 45, name: "Money Minigun", baseValue: 3250000, baseCustomValue: null, demand: "3" , image: "MoneyMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 46, name: "Money Gun", baseValue: 6500000, baseCustomValue: null, demand: "4" , image: "MoneyGun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 47, name: "Retro Rifle", baseValue: 3250000, baseCustomValue: null, demand: "2" , image: "RetroRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 48, name: "Neonrider Rifle", baseValue: 3250000, baseCustomValue: null, demand: "2" , image: "NeonRiderRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 49, name: "Neonrider Minigun", baseValue: 3250000, baseCustomValue: null, demand: "2" , image: "NeonRiderMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 50, name: "Whiteout Rifle", baseValue: 3250000, baseCustomValue: null, demand: "1" , image: "WhiteOutRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 51, name: "Whiteout Sniper", baseValue: 3250000, baseCustomValue: null, demand: "1" , image: "WhiteOutSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 52, name: "Whiteout Minigun", baseValue: 3250000, baseCustomValue: null, demand: "1" , image: "WhiteOutMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 53, name: "Sundown Rifle", baseValue: 52000, baseCustomValue: null, demand: "1" , image: "SundownRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 54, name: "Sundown Sniper", baseValue: 53000, baseCustomValue: null, demand: "1" , image: "SundownSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 55, name: "Sundown Minigun", baseValue: 52500, baseCustomValue: null, demand: "1" , image: "SundownMinigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 56, name: "Joystick Rifle", baseValue: 200000, baseCustomValue: null, demand: "1" , image: "JoystickRifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 57, name: "Joystick Sniper", baseValue: 205000, baseCustomValue: null, demand: "1" , image: "JoystickSniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 58, name: "Unit-005 Rifle", baseValue: 310000, baseCustomValue: null, demand: "1" , image: "Unit005Rifle.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 59, name: "Unit-006 Minigun", baseValue: 315000, baseCustomValue: null, demand: "1" , image: "Unit006Minigun.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
      { id: 60, name: "Unit-007 Sniper", baseValue: 320000, baseCustomValue: null, demand: "1" , image: "Unit007Sniper.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 35 },
	  { id: 61, name: "Early Access Case", baseValue: 6000000, baseCustomValue: null, demand: "5" , image: "EACase.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 1 },
      { id: 62, name: "Haunted Case", baseValue: 2500000, baseCustomValue: null, demand: "4" , image: "HauntedCase.png", stats: { studs: 0, tags: 0, minutes: 0, bullets: 0 }, serial: "", level: 1, maxLevel: 1 }
    ];
function filterItems(searchTerm, containerId) {
  const container = document.getElementById(containerId);
  const items = container.getElementsByClassName('item');
  searchTerm = searchTerm.toLowerCase();
  Array.from(items).forEach(item => {
    const itemName = item.querySelector('.item-name').textContent.toLowerCase();
    if (itemName.includes(searchTerm)) {
      item.style.display = '';
    } else {
      item.style.display = 'none';
    }
  });
}
let enabledStats = {
  studs: true,
  tags: true,
  minutes: true,
  bullets: true
};
let serialMultipliers = {
  level50: {
    a: 2,
    b: 17
  },
  level35: {
    a: 0.4,
    b: 3.6
  }
};
items.forEach(item => {
  const currentBaseValue = item.baseValue;
  const monthlyDeflationRate = 1 / 2.601;
  item.inflationData = {
    inflationRate: 2.601
  };
});
let yourTrade = [];
let theirTrade = [];
let yourCredits = 0;
let theirCredits = 0;
function formatValue(value) {
  const suffixes = ["", "k", "M", "B", "T"];
  let suffixIndex = 0;
  while (value >= 1000 && suffixIndex < suffixes.length - 1) {
    value /= 1000;
    suffixIndex++;
  }
  return value.toFixed(2) + suffixes[suffixIndex];
}
function createItemGrid(containerId) {
  const container = document.getElementById(containerId);
  document.querySelectorAll('.search-bar input').forEach(input => {
    input.addEventListener('input', e => {
      const containerId = e.target.closest('.trade-column').querySelector('.item-grid').id;
      filterItems(e.target.value, containerId);
    });
  });
  items.forEach(item => {
    item.value = item.baseValue;
    const itemElement = document.createElement('div');
    itemElement.className = 'item';
    itemElement.setAttribute('data-id', item.id);
    itemElement.innerHTML = `
          <img src="${item.image}" alt="${item.name}" width="60" height="60">
          <div class="item-name">${item.name}</div>
          <div class="demand-stars">
            ${'★'.repeat(item.demand)}${'☆'.repeat(5 - item.demand)}
          </div>
          <div class="base-value">
            <label>Base Value:</label>
            <input type="number" value="${item.baseCustomValue !== null ? item.baseCustomValue : item.baseValue}" min="0" step="1" class="base-value-input">
          </div>
          <div class="item-quantity">
            <button class="decrease">-</button>
            <input type="number" value="0" min="0" max="99">
            <button class="increase">+</button>
          </div>
          <div class="item-value">
            <input type="number" value="${item.value}" min="0" step="1"> credits
          </div>
          <div class="item-level">
            <label for="level-${item.id}">Level:</label>
            <input type="number" id="level-${item.id}" value="${item.level}" min="1" max="${item.maxLevel}" ${item.maxLevel === 1 ? 'readonly' : ''}>
          </div>
          <div class="item-serial">
            <label for="serial-${item.id}">Serial:</label>
            <input type="text" id="serial-${item.id}" placeholder="Enter serial">
          </div>
          <div class="item-stats">
            <div class="stat-grid">
              ${['studs', 'tags', 'minutes', 'bullets'].map(stat => `
                <div class="stat-multiplier">
                  <input type="checkbox" id="${item.id}-${stat}"> 
                  <label for="${item.id}-${stat}">${stat}:</label>
                  <input type="number" value="0" min="0" max="10" step="0.1" data-stat="${stat}" disabled>
                </div>
              `).join('')}
            </div>
          </div>
          <div class="item-inflation">
            <button class="show-inflation">Show Inflation Data</button>
            <div class="inflation-details" style="display: none;">
              <div class="projected-values"></div>
              <div class="inflation-rate">
                Monthly Inflation: 
                <input type="number" class="inflation-rate-input" value="160.1" min="0" max="1000" step="0.1">%
              </div>
            </div>
          </div>
        `;
    itemElement.querySelector('.base-value-input').addEventListener('change', e => {
      updateBaseValue(item, e.target.value);
    });
    itemElement.querySelector('.decrease').addEventListener('click', () => changeQuantity(item, containerId, -1));
    itemElement.querySelector('.increase').addEventListener('click', () => changeQuantity(item, containerId, 1));
    itemElement.querySelector('.item-quantity input').addEventListener('change', e => updateQuantity(item, containerId, e.target.value));
    itemElement.querySelector('.item-value input').addEventListener('change', e => updateValue(item, containerId, e.target.value));
    itemElement.querySelector('.item-level input').addEventListener('change', e => updateLevel(item, containerId, e.target.value));
    itemElement.querySelector('.item-serial input').addEventListener('input', e => {
      updateSerial(item, containerId, e.target.value);
    });
    itemElement.querySelectorAll('.stat-multiplier input[data-stat]').forEach(input => {
      input.addEventListener('change', e => updateStatMultiplier(item, containerId, e.target.dataset.stat, e.target.value));
    });
    itemElement.querySelectorAll('.stat-multiplier input[type="checkbox"]').forEach(checkbox => {
      checkbox.addEventListener('change', e => toggleStat(item, containerId, e.target.id.split('-')[1], e.target.checked));
    });
    itemElement.querySelector('.show-inflation').addEventListener('click', e => {
      const modalOverlay = document.querySelector('.modal-overlay');
      const modalContent = document.querySelector('.modal-content');
      const modalTitle = document.querySelector('.modal-title');
      modalTitle.textContent = `${item.name} Inflation Data`;
      const inflationDetails = itemElement.querySelector('.inflation-details').cloneNode(true);
      inflationDetails.style.display = 'block';
      modalContent.innerHTML = '';
      modalContent.appendChild(inflationDetails);
      modalOverlay.style.display = 'flex';
      updateInflationDisplay(modalContent, item);
    });
    container.appendChild(itemElement);
  });
}
function changeQuantity(item, side, change) {
  const itemElement = event.target.closest('.item');
  const input = itemElement.querySelector('.item-quantity input');
  const newValue = Math.max(0, Math.min(99, parseInt(input.value) + change));
  input.value = newValue;
  updateQuantity(item, side, newValue);
}
function updateBaseValue(item, newValue) {
  item.baseCustomValue = parseInt(newValue);
  updateItemValue(item, 'yourItems');
  updateItemValue(item, 'theirItems');
}
function updateQuantity(item, side, quantity) {
  const isYourSide = side === 'yourItems';
  const trade = isYourSide ? yourTrade : theirTrade;
  const itemElement = event.target.closest('.item');
  const tradeItem = {
    ...item,
    id: item.id,
    quantity: parseInt(quantity),
    value: item.value,
    level: item.level,
    stats: {
      ...item.stats
    },
    serial: item.serial
  };
  const index = trade.findIndex(i => i.id === item.id && i.level === item.level && i.serial === item.serial && JSON.stringify(i.stats) === JSON.stringify(item.stats));
  if (quantity > 0) {
    if (index === -1) {
      trade.push(tradeItem);
    } else {
      trade[index].quantity = parseInt(quantity);
    }
    itemElement.classList.add('selected');
  } else {
    if (index !== -1) {
      trade.splice(index, 1);
    }
    itemElement.classList.remove('selected');
  }
  updateItemValue(item, side);
  updateTradeSummary(isYourSide);
  updateResult();
}
function updateValue(item, side, newValue) {
  const isYourSide = side === 'yourItems';
  const trade = isYourSide ? yourTrade : theirTrade;
  const index = trade.findIndex(i => i.id === item.id && i.level === item.level && i.serial === item.serial && JSON.stringify(i.stats) === JSON.stringify(item.stats));
  item.value = parseInt(newValue);
  if (index !== -1) {
    trade[index].value = item.value;
  }
  updateTradeSummary(isYourSide);
  updateResult();
}
function updateSerial(item, side, serial) {
  const isYourSide = side === 'yourItems';
  const trade = isYourSide ? yourTrade : theirTrade;
  const index = trade.findIndex(i => i.id === item.id && i.level === item.level && i.serial === item.serial && JSON.stringify(i.stats) === JSON.stringify(item.stats));
  item.serial = serial;
  if (index !== -1) {
    trade[index].serial = serial;
  }
  updateItemValue(item, side);
  updateTradeSummary(isYourSide);
  updateResult();
}
function updateLevel(item, side, level) {
  const isYourSide = side === 'yourItems';
  const trade = isYourSide ? yourTrade : theirTrade;
  const index = trade.findIndex(i => i.id === item.id && i.level === item.level && i.serial === item.serial && JSON.stringify(i.stats) === JSON.stringify(item.stats));
  item.level = Math.min(parseInt(level), item.maxLevel);
  if (index !== -1) {
    trade[index].level = item.level;
  }
  updateItemValue(item, side);
}
function toggleStat(item, side, stat, enabled) {
  const itemElement = document.querySelector(`#${side} .item[data-id="${item.id}"]`);
  const statInput = itemElement.querySelector(`.stat-multiplier input[data-stat="${stat}"]`);
  if (enabled) {
    item.stats[stat] = parseFloat(statInput.value) || 1;
    statInput.disabled = false;
  } else {
    item.stats[stat] = 0;
    statInput.disabled = true;
  }
  updateItemValue(item, side);
}
function updateStatMultiplier(item, side, stat, value) {
  const isYourSide = side === 'yourItems';
  const trade = isYourSide ? yourTrade : theirTrade;
  const index = trade.findIndex(i => i.id === item.id && i.level === item.level && i.serial === item.serial && JSON.stringify(i.stats) === JSON.stringify(item.stats));
  item.stats[stat] = parseFloat(value) || 0;
  if (index !== -1) {
    trade[index].stats[stat] = item.stats[stat];
  }
  updateItemValue(item, side);
}
function calculateDemandBalance() {
  const yourTotalDemand = yourTrade.reduce((sum, item) => sum + item.demand * item.quantity, 0);
  const theirTotalDemand = theirTrade.reduce((sum, item) => sum + item.demand * item.quantity, 0);
  if (yourTrade.length === 0 || theirTrade.length === 0) {
    return 'No items to compare';
  }
  const demandDiff = theirTotalDemand - yourTotalDemand;
  if (demandDiff >= 1) {
    return 'WIN - You are receiving more demand stars';
  } else if (demandDiff <= -1) {
    return 'LOSS - You are giving more demand stars';
  }
  return 'EQUAL - Equal total demand stars';
}
function calculateInflationValue(baseValue, months, inflationRate) {
  return baseValue * Math.pow(inflationRate, months);
}
function updateItemValue(item, side) {
  const itemElement = document.querySelector(`#${side} .item[data-id="${item.id}"]`);
  const actualBaseValue = item.baseCustomValue !== null ? item.baseCustomValue : item.baseValue;
  const checkedStats = Object.keys(item.stats).filter(stat => {
    const checkbox = itemElement.querySelector(`input[type="checkbox"][id="${item.id}-${stat}"]`);
    return checkbox.checked && enabledStats[stat];
  }).length;
  let statMultiplier = 1;
  switch (checkedStats) {
    case 1:
      statMultiplier = 1.05;
      break;
    case 2:
      statMultiplier = 1.1;
      break;
    case 3:
      statMultiplier = 1.5;
      break;
    case 4:
      statMultiplier = 2.0;
      break;
  }
  const levelMultiplier = item.maxLevel > 1 ? 1 + 0.5 * ((item.level - 1) / (item.maxLevel - 1)) : 1;
  let serialMultiplier = 1;
  if (item.serial && !isNaN(parseInt(item.serial))) {
    const serialNumber = parseInt(item.serial);
    if (serialNumber > 0) {
      const level50A = parseFloat(document.getElementById('level50A').value);
      const level50B = parseFloat(document.getElementById('level50B').value);
      const level35A = parseFloat(document.getElementById('level35A').value);
      const level35B = parseFloat(document.getElementById('level35B').value);
      if (item.maxLevel === 50) {
        serialMultiplier = Math.max(1, -level50A * Math.log(serialNumber) + level50B);
      } else if (item.maxLevel === 35) {
        serialMultiplier = Math.max(1, -level35A * Math.log(serialNumber) + level35B);
      }
    }
  }
  const inflationMultiplier = 1;
  const newValue = Math.round(actualBaseValue * statMultiplier * levelMultiplier * serialMultiplier * inflationMultiplier);
  itemElement.querySelector('.item-value input').value = newValue;
  item.value = newValue;
  const isYourSide = side === 'yourItems';
  const trade = isYourSide ? yourTrade : theirTrade;
  const index = trade.findIndex(i => i.id === item.id && i.level === item.level && i.serial === item.serial && JSON.stringify(i.stats) === JSON.stringify(item.stats));
  if (index !== -1) {
    trade[index].value = newValue;
    trade[index].stats = {
      ...item.stats
    };
    trade[index].serial = item.serial;
    trade[index].level = item.level;
  }
  updateTradeSummary(isYourSide);
  updateResult();
}
function updateTradeSummary(isYourSide) {
  const trade = isYourSide ? yourTrade : theirTrade;
  const summaryElement = document.getElementById(isYourSide ? 'yourTradeItems' : 'theirTradeItems');
  const totalElement = document.getElementById(isYourSide ? 'yourTotal' : 'theirTotal');
  const credits = isYourSide ? yourCredits : theirCredits;
  let summaryHTML = '';
  if (credits > 0) {
    summaryHTML += `<div>Credits: ${formatValue(credits)}</div>`;
  }
  summaryHTML += trade.map((item, index) => {
    const activeStats = Object.entries(item.stats).filter(([_, value]) => value > 0).map(([stat, value]) => `${stat}: ${value}`).join(', ');
    const serialInfo = item.serial ? `Serial: ${item.serial}` : 'No serial';
    const statsInfo = activeStats ? `Stats: ${activeStats}` : 'No stats';
    return `<div>
          ${item.name} #${index + 1} (Lvl ${item.level}) x${item.quantity}: ${formatValue(item.value * item.quantity)} credits<br>
          ${statsInfo}<br>
          ${serialInfo}
        </div>`;
  }).join('');
  summaryElement.innerHTML = summaryHTML;
  const total = trade.reduce((sum, item) => sum + item.value * item.quantity, 0) + credits;
  totalElement.textContent = `Total: ${formatValue(total)} credits`;
}
function updateResult() {
  const yourTotal = yourTrade.reduce((sum, item) => sum + item.value * item.quantity, 0) + yourCredits;
  const theirTotal = theirTrade.reduce((sum, item) => sum + item.value * item.quantity, 0) + theirCredits;
  const difference = yourTotal - theirTotal;
  const result = document.getElementById('result');
  const demandBalance = calculateDemandBalance();
  let resultText = '';
  if (difference > 0) {
    resultText = `You are overpaying by ${formatValue(difference)} credits`;
    result.style.backgroundColor = `var(--result-overpay-bg)`;
  } else if (difference < 0) {
    resultText = `You are underpaying by ${formatValue(Math.abs(difference))} credits`;
    result.style.backgroundColor = `var(--result-underpay-bg)`;
  } else {
    resultText = 'The trade is balanced!';
    result.style.backgroundColor = `var(--result-balanced-bg)`;
  }
  result.innerHTML = `${resultText}<br><span style="font-size: 14px; opacity: 0.9; margin-top: 5px; display: block;">Demand Balance: ${demandBalance}</span>`;
  result.style.color = `var(--result-text-color)`;
}
function updateInflationDisplay(container, item) {
  const inflationDetails = container.querySelector('.inflation-details');
  const projectedValues = inflationDetails.querySelector('.projected-values');
  const checkedStats = Object.keys(item.stats).filter(stat => item.stats[stat] > 0).length;
  let statMultiplier = 1;
  switch (checkedStats) {
    case 1:
      statMultiplier = 1.05;
      break;
    case 2:
      statMultiplier = 1.1;
      break;
    case 3:
      statMultiplier = 1.5;
      break;
    case 4:
      statMultiplier = 2.0;
      break;
  }
  const levelMultiplier = item.maxLevel > 1 ? 1 + 0.5 * ((item.level - 1) / (item.maxLevel - 1)) : 1;
  let serialMultiplier = 1;
  if (item.serial && !isNaN(parseInt(item.serial))) {
    const serialNumber = parseInt(item.serial);
    if (serialNumber > 0) {
      const level50A = parseFloat(document.getElementById('level50A').value);
      const level50B = parseFloat(document.getElementById('level50B').value);
      const level35A = parseFloat(document.getElementById('level35A').value);
      const level35B = parseFloat(document.getElementById('level35B').value);
      if (item.maxLevel === 50) {
        serialMultiplier = Math.max(1, -level50A * Math.log(serialNumber) + level50B);
      } else if (item.maxLevel === 35) {
        serialMultiplier = Math.max(1, -level35A * Math.log(serialNumber) + level35B);
      }
    }
  }
  const totalMultiplier = statMultiplier * levelMultiplier * serialMultiplier;
  let chartContainer = inflationDetails.querySelector('.inflation-chart-container');
  if (!chartContainer) {
    chartContainer = document.createElement('div');
    chartContainer.className = 'inflation-chart-container';
    const canvas = document.createElement('canvas');
    chartContainer.appendChild(canvas);
    inflationDetails.insertBefore(chartContainer, projectedValues);
  }
  projectedValues.innerHTML = '<strong>Projected Values:</strong><br>';
  const currentDate = new Date();
  const projectedData = [];
  const currentValue = item.baseValue * totalMultiplier;
  const currentDateString = '2024-11';
  projectedValues.innerHTML += `${currentDateString}: ${formatValue(currentValue)} credits<br>`;
  projectedData.push({
    date: currentDateString,
    value: currentValue
  });
  for (let i = 1; i <= 6; i++) {
    const projectedDate = new Date(2024, 10 + i, 1);
    const projectedValue = calculateInflationValue(currentValue, i, item.inflationData.inflationRate);
    const dateString = `${projectedDate.getFullYear()}-${String(projectedDate.getMonth() + 1).padStart(2, '0')}`;
    projectedValues.innerHTML += `${dateString}: ${formatValue(projectedValue)} credits<br>`;
    projectedData.push({
      date: dateString,
      value: projectedValue
    });
  }
  const canvas = inflationDetails.querySelector('canvas');
  const ctx = canvas.getContext('2d');
  if (canvas.chart) {
    canvas.chart.destroy();
  }
  canvas.chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: projectedData.map(data => data.date),
      datasets: [{
        label: 'Projected Value',
        data: projectedData.map(data => data.value),
        borderColor: document.body.classList.contains('dark-mode') ? '#6aba6f' : '#4CAF50',
        backgroundColor: 'transparent',
        borderWidth: 2,
        pointRadius: 4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      animation: {
        duration: 500
      },
      scales: {
        y: {
          beginAtZero: false,
          grid: {
            color: document.body.classList.contains('dark-mode') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
          },
          ticks: {
            color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333'
          }
        },
        x: {
          grid: {
            color: document.body.classList.contains('dark-mode') ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
          },
          ticks: {
            color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333'
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333'
          }
        }
      }
    }
  });
  const inflationRateInput = inflationDetails.querySelector('.inflation-rate-input');
  inflationRateInput.addEventListener('change', e => {
    const newRate = parseFloat(e.target.value) / 100 + 1;
    item.inflationData.inflationRate = newRate;
    projectedValues.innerHTML = '<strong>Projected Values:</strong><br>';
    const projectedData = [];
    projectedValues.innerHTML += `${currentDateString}: ${formatValue(currentValue)} credits<br>`;
    projectedData.push({
      date: currentDateString,
      value: currentValue
    });
    for (let i = 1; i <= 6; i++) {
      const projectedDate = new Date(2024, 10 + i, 1);
      const projectedValue = calculateInflationValue(currentValue, i, newRate);
      const dateString = `${projectedDate.getFullYear()}-${String(projectedDate.getMonth() + 1).padStart(2, '0')}`;
      projectedValues.innerHTML += `${dateString}: ${formatValue(projectedValue)} credits<br>`;
      projectedData.push({
        date: dateString,
        value: projectedValue
      });
    }
    canvas.chart.data.labels = projectedData.map(data => data.date);
    canvas.chart.data.datasets[0].data = projectedData.map(data => data.value);
    canvas.chart.update();
  });
}
document.getElementById('yourMoney').addEventListener('change', e => updateCredits('your', e.target.value));
document.getElementById('theirMoney').addEventListener('change', e => updateCredits('their', e.target.value));
function updateCredits(side, amount) {
  if (side === 'your') {
    yourCredits = parseInt(amount);
  } else {
    theirCredits = parseInt(amount);
  }
  updateTradeSummary(side === 'your');
  updateResult();
}
document.getElementById('themeSelect').addEventListener('change', e => {
  changeTheme(e.target.value);
});
document.querySelectorAll('.color-pickers input[type="color"]').forEach(input => {
  input.addEventListener('change', () => {
    if (document.getElementById('themeSelect').value === 'custom') {
      applyCustomTheme();
    }
  });
});
document.getElementById('settingsToggle').addEventListener('click', () => {
  const panel = document.getElementById('settingsPanel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
});
document.querySelector('.settings-panel .close-button').addEventListener('click', () => {
  document.getElementById('settingsPanel').style.display = 'none';
});
document.getElementById('level50A').addEventListener('change', e => {
  serialMultipliers.level50.a = parseFloat(e.target.value);
  updateAllItems();
});
document.getElementById('level50B').addEventListener('change', e => {
  serialMultipliers.level50.b = parseFloat(e.target.value);
  updateAllItems();
});
document.getElementById('level35A').addEventListener('change', e => {
  serialMultipliers.level35.a = parseFloat(e.target.value);
  updateAllItems();
});
document.getElementById('level35B').addEventListener('change', e => {
  serialMultipliers.level35.b = parseFloat(e.target.value);
  updateAllItems();
});
function updateAllItems() {
  yourTrade.forEach(item => {
    const itemElement = document.querySelector(`#yourItems .item[data-id="${item.id}"]`);
    if (itemElement) {
      updateItemValue(item, 'yourItems');
    }
  });
  theirTrade.forEach(item => {
    const itemElement = document.querySelector(`#theirItems .item[data-id="${item.id}"]`);
    if (itemElement) {
      updateItemValue(item, 'theirItems');
    }
  });
}
['studs', 'tags', 'minutes', 'bullets'].forEach(stat => {
  document.getElementById(`enable${stat.charAt(0).toUpperCase() + stat.slice(1)}`).addEventListener('change', e => {
    enabledStats[stat] = e.target.checked;
    yourTrade.forEach(item => {
      const itemElement = document.querySelector(`#yourItems .item[data-id="${item.id}"]`);
      if (itemElement) {
        updateItemValue(item, 'yourItems');
      }
    });
    theirTrade.forEach(item => {
      const itemElement = document.querySelector(`#theirItems .item[data-id="${item.id}"]`);
      if (itemElement) {
        updateItemValue(item, 'theirItems');
      }
    });
  });
});
function exportSettings() {
  const settings = {
    theme: document.getElementById('themeSelect').value,
    customColors: {
      bgColor: document.getElementById('bgColor').value,
      containerBg: document.getElementById('containerBg').value,
      textColor: document.getElementById('textColor').value,
      borderColor: document.getElementById('borderColor').value,
      hoverBg: document.getElementById('hoverBg').value,
      selectedBorder: document.getElementById('selectedBorder').value,
      buttonBg: document.getElementById('buttonBg').value
    },
    enabledStats: {
      ...enabledStats
    },
    serialMultipliers: {
      ...serialMultipliers
    },
    customBaseValues: items.reduce((acc, item) => {
      if (item.baseCustomValue !== null) {
        acc[item.id] = item.baseCustomValue;
      }
      return acc;
    }, {})
  };
  const blob = new Blob([JSON.stringify(settings, null, 2)], {
    type: 'application/json'
  });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'trade-calculator-settings.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}
document.getElementById('importSettings').addEventListener('change', e => {
  if (e.target.files.length > 0) {
    importSettings(e.target.files[0]);
    e.target.value = '';
  }
});
function importSettings(file) {
  const reader = new FileReader();
  reader.onload = function (e) {
    try {
      const settings = JSON.parse(e.target.result);
      document.getElementById('themeSelect').value = settings.theme;
      changeTheme(settings.theme);
      if (settings.customColors) {
        document.getElementById('bgColor').value = settings.customColors.bgColor;
        document.getElementById('containerBg').value = settings.customColors.containerBg;
        document.getElementById('textColor').value = settings.customColors.textColor;
        document.getElementById('borderColor').value = settings.customColors.borderColor;
        document.getElementById('hoverBg').value = settings.customColors.hoverBg;
        document.getElementById('selectedBorder').value = settings.customColors.selectedBorder;
        document.getElementById('buttonBg').value = settings.customColors.buttonBg;
        if (settings.theme === 'custom') {
          applyCustomTheme();
        }
      }
      if (settings.enabledStats) {
        Object.entries(settings.enabledStats).forEach(([stat, enabled]) => {
          enabledStats[stat] = enabled;
          document.getElementById(`enable${stat.charAt(0).toUpperCase() + stat.slice(1)}`).checked = enabled;
        });
      }
      if (settings.serialMultipliers) {
        serialMultipliers = settings.serialMultipliers;
        document.getElementById('level50A').value = serialMultipliers.level50.a;
        document.getElementById('level50B').value = serialMultipliers.level50.b;
        document.getElementById('level35A').value = serialMultipliers.level35.a;
        document.getElementById('level35B').value = serialMultipliers.level35.b;
      }
      if (settings.customBaseValues) {
        items.forEach(item => {
          if (settings.customBaseValues[item.id] !== undefined) {
            item.baseCustomValue = settings.customBaseValues[item.id];
            const itemElement = document.querySelector(`#yourItems .item[data-id="${item.id}"]`);
            if (itemElement) {
              itemElement.querySelector('.base-value-input').value = item.baseCustomValue;
              updateItemValue(item, 'yourItems');
            }
          }
        });
      }
    } catch (error) {
      alert('Failed to import settings: ' + error.message);
    }
  };
}
function changeTheme(theme) {
  document.body.classList.remove('light-theme', 'dark-theme', 'red-theme', 'green-theme', 'blue-theme', 'custom-theme');
  document.body.classList.add(theme + '-theme');
  if (theme === 'dark') {
    document.body.classList.add('dark-mode');
  } else {
    document.body.classList.remove('dark-mode');
  }
  if (theme === 'custom') {
    applyCustomTheme();
  }
  const charts = document.querySelectorAll('canvas');
  charts.forEach(canvas => {
    if (canvas.chart) {
      const isDark = document.body.classList.contains('dark-mode');
      canvas.chart.options.scales.y.grid.color = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      canvas.chart.options.scales.x.grid.color = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      canvas.chart.options.scales.y.ticks.color = isDark ? '#e0e0e0' : '#333';
      canvas.chart.options.scales.x.ticks.color = isDark ? '#e0e0e0' : '#333';
      canvas.chart.options.plugins.legend.labels.color = isDark ? '#e0e0e0' : '#333';
      canvas.chart.update();
    }
  });
}
function applyCustomTheme() {
  document.documentElement.style.setProperty('--bg-color', document.getElementById('bgColor').value);
  document.documentElement.style.setProperty('--container-bg', document.getElementById('containerBg').value);
  document.documentElement.style.setProperty('--text-color', document.getElementById('textColor').value);
  document.documentElement.style.setProperty('--border-color', document.getElementById('borderColor').value);
  document.documentElement.style.setProperty('--hover-bg', document.getElementById('hoverBg').value);
  document.documentElement.style.setProperty('--selected-border', document.getElementById('selectedBorder').value);
  document.documentElement.style.setProperty('--button-bg', document.getElementById('buttonBg').value);
}
createItemGrid('yourItems');
createItemGrid('theirItems');</script>
</body>
</html>
